% ARMAZÉNS ------------------------------------------

% idArmazem(<local>,<codigo>)
idArmazem('Arouca',1).
idArmazem('Espinho',2).
idArmazem('Gondomar',3).
idArmazem('Maia',4).
idArmazem('Matosinhos',5).
idArmazem('Oliveira de Azemeis',6).
idArmazem('Paredes',7).
idArmazem('Porto',8).
idArmazem('Povoa de Varzim',9).
idArmazem('Santa Maria da Feira',10).
idArmazem('Santo Tirso',11).
idArmazem('Sao Joao da Madeira',12).
idArmazem('Trofa',13).
idArmazem('Vale de Cambra',14).
idArmazem('Valongo',15).
idArmazem('Vila do Conde',16).
idArmazem('Vila Nova de Gaia',17).

partida_chegada(5).


% CAMIÕES -------------------------------------------

carateristicasCam(eTruck01,7500,4300,80,100,60).

%dadosCam_t_e_ta(<nome_camiao>,<cidade_origem>,<cidade_destino>,<tempo>,<energia>,<tempo_adicional>).
dadosCam_t_e_ta(eTruck01,1,2,122,42,0).
dadosCam_t_e_ta(eTruck01,1,3,122,46,0).
dadosCam_t_e_ta(eTruck01,1,4,151,54,25).
dadosCam_t_e_ta(eTruck01,1,5,147,52,25).
dadosCam_t_e_ta(eTruck01,1,6,74,24,0).
dadosCam_t_e_ta(eTruck01,1,7,116,35,0).
dadosCam_t_e_ta(eTruck01,1,8,141,46,0).
dadosCam_t_e_ta(eTruck01,1,9,185,74,53).
dadosCam_t_e_ta(eTruck01,1,10,97,30,0).
dadosCam_t_e_ta(eTruck01,1,11,164,64,40).
dadosCam_t_e_ta(eTruck01,1,12,76,23,0).
dadosCam_t_e_ta(eTruck01,1,13,174,66,45).
dadosCam_t_e_ta(eTruck01,1,14,59,18,0).
dadosCam_t_e_ta(eTruck01,1,15,132,51,24).
dadosCam_t_e_ta(eTruck01,1,16,181,68,45).
dadosCam_t_e_ta(eTruck01,1,17,128,45,0).

dadosCam_t_e_ta(eTruck01,2,1,116,42,0).
dadosCam_t_e_ta(eTruck01,2,3,55,22,0).
dadosCam_t_e_ta(eTruck01,2,4,74,25,0).
dadosCam_t_e_ta(eTruck01,2,5,65,22,0).
dadosCam_t_e_ta(eTruck01,2,6,69,27,0).
dadosCam_t_e_ta(eTruck01,2,7,74,38,0).
dadosCam_t_e_ta(eTruck01,2,8,61,18,0).
dadosCam_t_e_ta(eTruck01,2,9,103,44,0).
dadosCam_t_e_ta(eTruck01,2,10,36,14,0).
dadosCam_t_e_ta(eTruck01,2,11,88,41,0).
dadosCam_t_e_ta(eTruck01,2,12,61,19,0).
dadosCam_t_e_ta(eTruck01,2,13,95,42,0).
dadosCam_t_e_ta(eTruck01,2,14,78,34,0).
dadosCam_t_e_ta(eTruck01,2,15,69,30,0).
dadosCam_t_e_ta(eTruck01,2,16,99,38,0).
dadosCam_t_e_ta(eTruck01,2,17,46,14,0).

dadosCam_t_e_ta(eTruck01,3,1,120,45,0).
dadosCam_t_e_ta(eTruck01,3,2,50,22,0).
dadosCam_t_e_ta(eTruck01,3,4,46,15,0).
dadosCam_t_e_ta(eTruck01,3,5,46,14,0).
dadosCam_t_e_ta(eTruck01,3,6,74,37,0).
dadosCam_t_e_ta(eTruck01,3,7,63,23,0).
dadosCam_t_e_ta(eTruck01,3,8,38,8,0).
dadosCam_t_e_ta(eTruck01,3,9,84,36,0).
dadosCam_t_e_ta(eTruck01,3,10,59,28,0).
dadosCam_t_e_ta(eTruck01,3,11,61,27,0).
dadosCam_t_e_ta(eTruck01,3,12,67,32,0).
dadosCam_t_e_ta(eTruck01,3,13,67,29,0).
dadosCam_t_e_ta(eTruck01,3,14,82,38,0).
dadosCam_t_e_ta(eTruck01,3,15,34,8,0).
dadosCam_t_e_ta(eTruck01,3,16,80,30,0).
dadosCam_t_e_ta(eTruck01,3,17,36,10,0).

dadosCam_t_e_ta(eTruck01,4,1,149,54,25).
dadosCam_t_e_ta(eTruck01,4,2,65,24,0).
dadosCam_t_e_ta(eTruck01,4,3,46,16,0).
dadosCam_t_e_ta(eTruck01,4,5,27,10,0).
dadosCam_t_e_ta(eTruck01,4,6,103,47,0).
dadosCam_t_e_ta(eTruck01,4,7,55,27,0).
dadosCam_t_e_ta(eTruck01,4,8,36,10,0).
dadosCam_t_e_ta(eTruck01,4,9,50,26,0).
dadosCam_t_e_ta(eTruck01,4,10,78,34,0).
dadosCam_t_e_ta(eTruck01,4,11,42,19,0).
dadosCam_t_e_ta(eTruck01,4,12,97,42,0).
dadosCam_t_e_ta(eTruck01,4,13,44,11,0).
dadosCam_t_e_ta(eTruck01,4,14,111,48,0).
dadosCam_t_e_ta(eTruck01,4,15,32,13,0).
dadosCam_t_e_ta(eTruck01,4,16,53,14,0).
dadosCam_t_e_ta(eTruck01,4,17,38,11,0).

dadosCam_t_e_ta(eTruck01,5,1,141,51,24).
dadosCam_t_e_ta(eTruck01,5,2,55,20,0).
dadosCam_t_e_ta(eTruck01,5,3,48,14,0).
dadosCam_t_e_ta(eTruck01,5,4,25,9,0).
dadosCam_t_e_ta(eTruck01,5,6,97,44,0).
dadosCam_t_e_ta(eTruck01,5,7,55,28,0).
dadosCam_t_e_ta(eTruck01,5,8,29,7,0).
dadosCam_t_e_ta(eTruck01,5,9,48,24,0).
dadosCam_t_e_ta(eTruck01,5,10,69,30,0).
dadosCam_t_e_ta(eTruck01,5,11,53,26,0).
dadosCam_t_e_ta(eTruck01,5,12,95,36,0).
dadosCam_t_e_ta(eTruck01,5,13,63,20,0).
dadosCam_t_e_ta(eTruck01,5,14,105,45,0).
dadosCam_t_e_ta(eTruck01,5,15,34,14,0).
dadosCam_t_e_ta(eTruck01,5,16,46,18,0).
dadosCam_t_e_ta(eTruck01,5,17,27,7,0).

dadosCam_t_e_ta(eTruck01,6,1,69,23,0).
dadosCam_t_e_ta(eTruck01,6,2,71,27,0).
dadosCam_t_e_ta(eTruck01,6,3,74,38,0).
dadosCam_t_e_ta(eTruck01,6,4,103,46,0).
dadosCam_t_e_ta(eTruck01,6,5,99,44,0).
dadosCam_t_e_ta(eTruck01,6,7,88,48,0).
dadosCam_t_e_ta(eTruck01,6,8,92,38,0).
dadosCam_t_e_ta(eTruck01,6,9,134,66,45).
dadosCam_t_e_ta(eTruck01,6,10,42,14,0).
dadosCam_t_e_ta(eTruck01,6,11,116,56,30).
dadosCam_t_e_ta(eTruck01,6,12,23,9,0).
dadosCam_t_e_ta(eTruck01,6,13,126,58,33).
dadosCam_t_e_ta(eTruck01,6,14,25,9,0).
dadosCam_t_e_ta(eTruck01,6,15,84,44,0).
dadosCam_t_e_ta(eTruck01,6,16,132,60,35).
dadosCam_t_e_ta(eTruck01,6,17,80,38,0).

dadosCam_t_e_ta(eTruck01,7,1,116,36,0).
dadosCam_t_e_ta(eTruck01,7,2,71,38,0).
dadosCam_t_e_ta(eTruck01,7,3,61,22,0).
dadosCam_t_e_ta(eTruck01,7,4,53,26,0).
dadosCam_t_e_ta(eTruck01,7,5,53,28,0).
dadosCam_t_e_ta(eTruck01,7,6,88,48,0).
dadosCam_t_e_ta(eTruck01,7,8,59,26,0).
dadosCam_t_e_ta(eTruck01,7,9,88,48,0).
dadosCam_t_e_ta(eTruck01,7,10,84,44,0).
dadosCam_t_e_ta(eTruck01,7,11,74,22,0).
dadosCam_t_e_ta(eTruck01,7,12,82,42,0).
dadosCam_t_e_ta(eTruck01,7,13,76,31,0).
dadosCam_t_e_ta(eTruck01,7,14,97,49,21).
dadosCam_t_e_ta(eTruck01,7,15,29,16,0).
dadosCam_t_e_ta(eTruck01,7,16,84,42,0).
dadosCam_t_e_ta(eTruck01,7,17,69,30,0).

dadosCam_t_e_ta(eTruck01,8,1,134,46,0).
dadosCam_t_e_ta(eTruck01,8,2,59,18,0).
dadosCam_t_e_ta(eTruck01,8,3,32,6,0).
dadosCam_t_e_ta(eTruck01,8,4,34,10,0).
dadosCam_t_e_ta(eTruck01,8,5,32,7,0).
dadosCam_t_e_ta(eTruck01,8,6,88,38,0).
dadosCam_t_e_ta(eTruck01,8,7,57,26,0).
dadosCam_t_e_ta(eTruck01,8,9,69,30,0).
dadosCam_t_e_ta(eTruck01,8,10,65,26,0).
dadosCam_t_e_ta(eTruck01,8,11,53,22,0).
dadosCam_t_e_ta(eTruck01,8,12,82,34,0).
dadosCam_t_e_ta(eTruck01,8,13,61,24,0).
dadosCam_t_e_ta(eTruck01,8,14,97,40,0).
dadosCam_t_e_ta(eTruck01,8,15,36,12,0).
dadosCam_t_e_ta(eTruck01,8,16,65,23,0).
dadosCam_t_e_ta(eTruck01,8,17,32,6,0).

dadosCam_t_e_ta(eTruck01,9,1,181,72,50).
dadosCam_t_e_ta(eTruck01,9,2,95,41,0).
dadosCam_t_e_ta(eTruck01,9,3,86,35,0).
dadosCam_t_e_ta(eTruck01,9,4,55,24,0).
dadosCam_t_e_ta(eTruck01,9,5,48,23,0).
dadosCam_t_e_ta(eTruck01,9,6,134,65,42).
dadosCam_t_e_ta(eTruck01,9,7,95,47,0).
dadosCam_t_e_ta(eTruck01,9,8,69,28,0).
dadosCam_t_e_ta(eTruck01,9,10,109,51,24).
dadosCam_t_e_ta(eTruck01,9,11,61,29,0).
dadosCam_t_e_ta(eTruck01,9,12,132,57,31).
dadosCam_t_e_ta(eTruck01,9,13,67,19,0).
dadosCam_t_e_ta(eTruck01,9,14,143,66,45).
dadosCam_t_e_ta(eTruck01,9,15,71,34,0).
dadosCam_t_e_ta(eTruck01,9,16,15,3,0).
dadosCam_t_e_ta(eTruck01,9,17,67,28,0).

dadosCam_t_e_ta(eTruck01,10,1,97,30,0).
dadosCam_t_e_ta(eTruck01,10,2,34,14,0).
dadosCam_t_e_ta(eTruck01,10,3,59,27,0).
dadosCam_t_e_ta(eTruck01,10,4,78,33,0).
dadosCam_t_e_ta(eTruck01,10,5,71,30,0).
dadosCam_t_e_ta(eTruck01,10,6,40,14,0).
dadosCam_t_e_ta(eTruck01,10,7,82,42,0).
dadosCam_t_e_ta(eTruck01,10,8,65,24,0).
dadosCam_t_e_ta(eTruck01,10,9,109,52,25).
dadosCam_t_e_ta(eTruck01,10,11,92,46,0).
dadosCam_t_e_ta(eTruck01,10,12,32,6,0).
dadosCam_t_e_ta(eTruck01,10,13,99,46,0).
dadosCam_t_e_ta(eTruck01,10,14,63,17,0).
dadosCam_t_e_ta(eTruck01,10,15,74,34,0).
dadosCam_t_e_ta(eTruck01,10,16,105,46,0).
dadosCam_t_e_ta(eTruck01,10,17,53,23,0).

dadosCam_t_e_ta(eTruck01,11,1,164,65,42).
dadosCam_t_e_ta(eTruck01,11,2,88,41,0).
dadosCam_t_e_ta(eTruck01,11,3,65,28,0).
dadosCam_t_e_ta(eTruck01,11,4,42,18,0).
dadosCam_t_e_ta(eTruck01,11,5,55,25,0).
dadosCam_t_e_ta(eTruck01,11,6,118,57,31).
dadosCam_t_e_ta(eTruck01,11,7,74,23,0).
dadosCam_t_e_ta(eTruck01,11,8,59,23,0).
dadosCam_t_e_ta(eTruck01,11,9,63,28,0).
dadosCam_t_e_ta(eTruck01,11,10,97,46,0).
dadosCam_t_e_ta(eTruck01,11,12,111,52,25).
dadosCam_t_e_ta(eTruck01,11,13,25,7,0).
dadosCam_t_e_ta(eTruck01,11,14,126,58,33).
dadosCam_t_e_ta(eTruck01,11,15,53,25,0).
dadosCam_t_e_ta(eTruck01,11,16,59,27,0).
dadosCam_t_e_ta(eTruck01,11,17,67,27,0).

dadosCam_t_e_ta(eTruck01,12,1,76,23,0).
dadosCam_t_e_ta(eTruck01,12,2,61,19,0).
dadosCam_t_e_ta(eTruck01,12,3,67,32,0).
dadosCam_t_e_ta(eTruck01,12,4,97,41,0).
dadosCam_t_e_ta(eTruck01,12,5,92,38,0).
dadosCam_t_e_ta(eTruck01,12,6,19,8,0).
dadosCam_t_e_ta(eTruck01,12,7,82,42,0).
dadosCam_t_e_ta(eTruck01,12,8,86,33,0).
dadosCam_t_e_ta(eTruck01,12,9,128,61,37).
dadosCam_t_e_ta(eTruck01,12,10,32,6,0).
dadosCam_t_e_ta(eTruck01,12,11,109,50,23).
dadosCam_t_e_ta(eTruck01,12,13,120,53,26).
dadosCam_t_e_ta(eTruck01,12,14,40,10,0).
dadosCam_t_e_ta(eTruck01,12,15,78,38,0).
dadosCam_t_e_ta(eTruck01,12,16,126,54,28).
dadosCam_t_e_ta(eTruck01,12,17,74,32,0).

dadosCam_t_e_ta(eTruck01,13,1,174,65,42).
dadosCam_t_e_ta(eTruck01,13,2,107,35,0).
dadosCam_t_e_ta(eTruck01,13,3,74,29,0).
dadosCam_t_e_ta(eTruck01,13,4,46,11,0).
dadosCam_t_e_ta(eTruck01,13,5,67,20,0).
dadosCam_t_e_ta(eTruck01,13,6,128,57,31).
dadosCam_t_e_ta(eTruck01,13,7,80,30,0).
dadosCam_t_e_ta(eTruck01,13,8,76,20,0).
dadosCam_t_e_ta(eTruck01,13,9,67,20,0).
dadosCam_t_e_ta(eTruck01,13,10,105,47,0).
dadosCam_t_e_ta(eTruck01,13,11,27,7,0).
dadosCam_t_e_ta(eTruck01,13,12,122,52,25).
dadosCam_t_e_ta(eTruck01,13,14,137,58,33).
dadosCam_t_e_ta(eTruck01,13,15,67,17,0).
dadosCam_t_e_ta(eTruck01,13,16,59,15,0).
dadosCam_t_e_ta(eTruck01,13,17,78,22,0).

dadosCam_t_e_ta(eTruck01,14,1,59,18,0).
dadosCam_t_e_ta(eTruck01,14,2,80,35,0).
dadosCam_t_e_ta(eTruck01,14,3,80,38,0).
dadosCam_t_e_ta(eTruck01,14,4,109,46,0).
dadosCam_t_e_ta(eTruck01,14,5,105,45,0).
dadosCam_t_e_ta(eTruck01,14,6,27,9,0).
dadosCam_t_e_ta(eTruck01,14,7,97,48,0).
dadosCam_t_e_ta(eTruck01,14,8,99,38,0).
dadosCam_t_e_ta(eTruck01,14,9,143,66,45).
dadosCam_t_e_ta(eTruck01,14,10,61,17,0).
dadosCam_t_e_ta(eTruck01,14,11,122,57,31).
dadosCam_t_e_ta(eTruck01,14,12,42,10,0).
dadosCam_t_e_ta(eTruck01,14,13,132,58,35).
dadosCam_t_e_ta(eTruck01,14,15,90,44,0).
dadosCam_t_e_ta(eTruck01,14,16,139,61,37).
dadosCam_t_e_ta(eTruck01,14,17,86,38,0).

dadosCam_t_e_ta(eTruck01,15,1,132,51,24).
dadosCam_t_e_ta(eTruck01,15,2,74,30,0).
dadosCam_t_e_ta(eTruck01,15,3,34,8,0).
dadosCam_t_e_ta(eTruck01,15,4,36,12,0).
dadosCam_t_e_ta(eTruck01,15,5,36,14,0).
dadosCam_t_e_ta(eTruck01,15,6,86,44,0).
dadosCam_t_e_ta(eTruck01,15,7,34,16,0).
dadosCam_t_e_ta(eTruck01,15,8,42,13,0).
dadosCam_t_e_ta(eTruck01,15,9,71,35,0).
dadosCam_t_e_ta(eTruck01,15,10,82,36,0).
dadosCam_t_e_ta(eTruck01,15,11,53,25,0).
dadosCam_t_e_ta(eTruck01,15,12,80,38,0).
dadosCam_t_e_ta(eTruck01,15,13,69,18,0).
dadosCam_t_e_ta(eTruck01,15,14,95,45,0).
dadosCam_t_e_ta(eTruck01,15,16,69,29,0).
dadosCam_t_e_ta(eTruck01,15,17,53,17,0).

dadosCam_t_e_ta(eTruck01,16,1,179,68,45).
dadosCam_t_e_ta(eTruck01,16,2,92,37,0).
dadosCam_t_e_ta(eTruck01,16,3,84,31,0).
dadosCam_t_e_ta(eTruck01,16,4,57,16,0).
dadosCam_t_e_ta(eTruck01,16,5,46,18,0).
dadosCam_t_e_ta(eTruck01,16,6,132,60,35).
dadosCam_t_e_ta(eTruck01,16,7,92,42,0).
dadosCam_t_e_ta(eTruck01,16,8,67,23,0).
dadosCam_t_e_ta(eTruck01,16,9,15,3,0).
dadosCam_t_e_ta(eTruck01,16,10,105,46,0).
dadosCam_t_e_ta(eTruck01,16,11,57,28,0).
dadosCam_t_e_ta(eTruck01,16,12,130,52,25).
dadosCam_t_e_ta(eTruck01,16,13,61,15,0).
dadosCam_t_e_ta(eTruck01,16,14,141,61,37).
dadosCam_t_e_ta(eTruck01,16,15,69,29,0).
dadosCam_t_e_ta(eTruck01,16,17,65,24,0).

dadosCam_t_e_ta(eTruck01,17,1,128,46,0).
dadosCam_t_e_ta(eTruck01,17,2,42,14,0).
dadosCam_t_e_ta(eTruck01,17,3,40,11,0).
dadosCam_t_e_ta(eTruck01,17,4,42,13,0).
dadosCam_t_e_ta(eTruck01,17,5,34,10,0).
dadosCam_t_e_ta(eTruck01,17,6,82,38,0).
dadosCam_t_e_ta(eTruck01,17,7,74,30,0).
dadosCam_t_e_ta(eTruck01,17,8,29,6,0).
dadosCam_t_e_ta(eTruck01,17,9,69,31,0).
dadosCam_t_e_ta(eTruck01,17,10,55,24,0).
dadosCam_t_e_ta(eTruck01,17,11,69,29,0).
dadosCam_t_e_ta(eTruck01,17,12,80,30,0).
dadosCam_t_e_ta(eTruck01,17,13,82,23,0).
dadosCam_t_e_ta(eTruck01,17,14,90,38,0).
dadosCam_t_e_ta(eTruck01,17,15,53,18,0).
dadosCam_t_e_ta(eTruck01,17,16,67,25,0).


% ENTREGAS -------------------------------------------

% entrega(<idEntrega>,<data>,<massaEntrega>,<armazemEntrega>,<tempoColoc>,<tempoRet>)
entrega(4439, 20221205, 200, 1, 8, 10).
entrega(4438, 20221205, 150, 9, 7, 9).
entrega(4445, 20221205, 100, 3, 5, 7).
entrega(4443, 20221205, 120, 8, 6, 8).
entrega(4449, 20221205, 300, 11, 15, 20).
entrega(4398, 20221205, 310, 17, 16, 20).
entrega(4432, 20221205, 270, 14, 14, 18).
entrega(4437, 20221205, 180, 12, 9, 11).
entrega(4451, 20221205, 220, 6, 9, 12).
entrega(4452, 20221205, 390, 13, 21, 26).
entrega(4444, 20221205, 380, 2, 20, 25).
entrega(4455, 20221205, 280, 7, 14, 19).
entrega(4399, 20221205, 260, 15, 13, 18).
entrega(4454, 20221205, 350, 10, 18, 22).
entrega(4446, 20221205, 260, 4, 14, 17).
entrega(4456, 20221205, 330, 16, 17, 21).


% ALGORITMOS ----------------------------------------

:- dynamic tempo_min/2.



calcula_custo(Nome,LE,Tempo):-
    partida_chegada(PC),
    append([PC|LE],[PC],LEcompleto),

    carateristicasCam(Nome,Tara,_,CargaBat,_,_),

    CargaMax is CargaBat,
    capacidadeMax(Nome,PesoMax),
    soma_pesos(LE,L,_),
    acrescenta_tara(Tara,L,LPesos),
    custo(Nome,LEcompleto,CargaBat,Tempo,PesoMax,CargaMax,LPesos,PC).
 custo(_,[_],_,0,_,_,[],_).
/*T = Tempo de Viagem
 *TCarga = Tempo de Carregamento da Bateria
*/

custo(Nome,[E1,PC],CargaBat,Tempo,PesoMax,CargaMax,[X|LPesos],PC):-
    dadosCam_t_e_ta(Nome,E1,PC,T,Energia,TmpAdicional),
    TempoGasto is T * X/PesoMax,
    CargaGasta is Energia * X/PesoMax,
    DifCargas is CargaBat - CargaGasta,(E1 is PC, /*Chega ao local e ve tempo entrega*/
    TDescarregamento is 0;entrega(_,_,_,E1,_,TDescarregamento)),
    (DifCargas < 0.2*CargaMax,!,
     /*carregar o que tem ate 80%*/
       carateristicasCam(Nome,_,_,_,_,TCarregamento), /*Tempo de Carregamento*/
       BateriaCar is (0.8*CargaMax)-(0.2*CargaMax), /*BateriaCar È a diferenca de bateria de 80% e 20% (64-16)*/
        CargaNecessaria is (0.2*CargaMax)-(CargaBat-CargaGasta),
       ( CargaNecessaria < (CargaMax * 0.8),
        TCarga2 is CargaNecessaria *(TCarregamento/BateriaCar),
         CargaBat1 is 0.2*CargaMax,
         (TCarga2 > TDescarregamento,TCarga is TCarga2;TCarga is TDescarregamento),
         custo(Nome,[PC],CargaBat1,Tempo1,PesoMax,CargaMax,LPesos,PC),
           Tempo is TCarga+TempoGasto+Tempo1;
       DiferencaQueFalta is (0.8*CargaMax)-CargaBat,
       TCarga1 is DiferencaQueFalta * (TCarregamento/BateriaCar),
       CargaBat1 is 0.8*CargaMax,
       (TCarga1 > TDescarregamento,TCarga is TCarga1;TCarga is TDescarregamento),
       DifCargas1 is CargaBat1 - CargaGasta, /*80% da bateria - KWh da viagem*/
          (DifCargas1 < 0.2*CargaMax,!, /*Verificar se chega*/
           CargaBat2 is 0.2*CargaMax, /*Chega ao destino com 20% de bateria*/
           TCarga2 is TCarga + TmpAdicional, /*Carga intermÈdia*/
           custo(Nome,[PC],CargaBat2,Tempo1,PesoMax,CargaMax,LPesos,PC),
           Tempo is TCarga2+TempoGasto+Tempo1));
    TCarga is TDescarregamento,
    CargaBat1 is DifCargas,
    custo(Nome,[PC],CargaBat1,Tempo1,PesoMax,CargaMax,LPesos,PC),
    Tempo is TCarga+TempoGasto+Tempo1),!.


custo(Nome,[E1,E2|LE],CargaBat,Tempo,PesoMax,CargaMax,[X|LPesos],PC):-
    dadosCam_t_e_ta(Nome,E1,E2,T,Energia,TmpAdicional),
    TempoGasto is T * X/PesoMax,
    CargaGasta is Energia * X/PesoMax,
    DifCargas is CargaBat - CargaGasta,(E1 is PC, /*Chega ao local e ve tempo entrega*/
    TDescarregamento is 0;entrega(_,_,_,E1,_,TDescarregamento)),
    (DifCargas < 0.2*CargaMax,!,
     /*carregar o que tem ate 80%*/
       carateristicasCam(Nome,_,_,_,_,TCarregamento), /*Tempo de Carregamento*/
     BateriaCar is (0.8*CargaMax)-(0.2*CargaMax), /*BateriaCar È a diferenca de bateria de 80% e 20% (64-16)*/
       DiferencaQueFalta is (0.8*CargaMax)-CargaBat,  /*Quanto falta para a bateria chegar a 80%*/
       TCarga1 is DiferencaQueFalta * (TCarregamento/BateriaCar),CargaBat1 is 0.8*CargaMax,
       (TCarga1 > TDescarregamento,TCarga is TCarga1;TCarga is TDescarregamento),
       DifCargas1 is CargaBat1 - CargaGasta, /*80% da bateria - KWh da viagem*/
          (DifCargas1 < 0.2*CargaMax,!, /*Verificar se chega*/
           CargaBat2 is 0.2*CargaMax, /*Chega ao destino com 20% de bateria*/
           TCarga2 is TCarga + TmpAdicional, /*Carga intermÈdia*/
           custo(Nome,[E2|LE],CargaBat2,Tempo1,PesoMax,CargaMax,LPesos,PC),
           Tempo is TCarga2+TempoGasto+Tempo1;
           custo(Nome,[E2|LE],DifCargas1,Tempo1,PesoMax,CargaMax,LPesos,PC),
           Tempo is TCarga+TempoGasto+Tempo1);
    TCarga is TDescarregamento,
    CargaBat1 is DifCargas,
    custo(Nome,[E2|LE],CargaBat1,Tempo1,PesoMax,CargaMax,LPesos,PC),
    Tempo is TCarga+TempoGasto+Tempo1),!.



%Calculo das Massas

capacidadeMax(Nome,PesoMax):-carateristicasCam(Nome,T,Max,_,_,_),PesoMax is  T+Max.

soma_pesos([],[],0).
soma_pesos([IdAr|LC],[PesoAc|LP],PesoAc):-soma_pesos(LC,LP,PesoAc1),entrega(_,_,Peso,IdAr,_,_),PesoAc is Peso+PesoAc1.

acrescenta_tara(Tara,[],[Tara]).
acrescenta_tara(Tara,[Peso|LP],[PesoTara|LPT]):- acrescenta_tara(Tara,LP,LPT), PesoTara is Peso+Tara.

%b seq_custo_min 50

seq_tempo_min(Nome,LA,Tempo):-(run(Nome);true),tempo_min(LA,Tempo).

seq_consult_time(Nome,LA,Tempo):-
    get_time(Ti),
    write('Ti='),write(Ti),nl,
    (run(Nome);true),
    tempo_min(LA,Tempo),
    get_time(Tf),
    write('Tf='),write(Tf),
    TSol is Tf-Ti,nl,
    write('TSol='),write(TSol).

entregas(L):-findall(Id,entrega(_,_,_,Id,_,_),L).

run(Nome):-
    retractall(tempo_min(_,_)),
    assertz(tempo_min(_,100000)),
    entregas(LA),
    permutation(LA,LAPerm),
    calcula_custo(Nome,LAPerm,Tempo),
    atualiza(LAPerm,Tempo),
    fail.

atualiza(LEPerm,Tempo):-
  tempo_min(_,TempoMin),
  ((Tempo<TempoMin,!,retract(tempo_min(_,_)),
    assertz(tempo_min(LEPerm,Tempo)))
    ;true).

%Heuristica Menor Tempo

heuristica_menor_tempo(Nome,LAPerm,Tempo):-
    partida_chegada(PC),
    entregas(LA),
    append([PC|LA],[],LACompleto),
    menor_tempo(Nome,LACompleto,LAPerm),
    calcula_custo(Nome,LAPerm,Tempo).


procura_menor(_,_,[],9999999,0).

procura_menor(Nome,ATUAL,[E|LE],MENOR,NODE_MENOR):-
    procura_menor(Nome,ATUAL,LE,MENOR1,NODE_MENOR1),
    dadosCam_t_e_ta(Nome,ATUAL,E,TEMPO,_,_),
    (TEMPO<MENOR1,MENOR is TEMPO, NODE_MENOR is E;MENOR is MENOR1, NODE_MENOR is NODE_MENOR1).


menor_tempo(Nome,[E|LE],LE_ORDENADA):-
    menor_tempo1(Nome,E,LE,LE_ORDENADA).

menor_tempo1(_,_,[],[]).

menor_tempo1(Nome,ATUAL,LE,[PROX|LE_ORDENADA]):-
    procura_menor(Nome,ATUAL,LE,_,PROX), delete(LE,PROX,LE1),
    menor_tempo1(Nome,PROX,LE1,LE_ORDENADA).

%Heuristica Maior Massa

heuristica_maior_massa(Nome,LAPerm,Tempo):-
    entregas(LA),
    maior_massa(Nome,LA,LAPerm),
    calcula_custo(Nome,LAPerm,Tempo).

procura_maior(_,[],0,0).

procura_maior(Nome,[E|LE],MAIOR,NODE_MAIOR):-
    procura_maior(Nome,LE,MAIOR1,NODE_MAIOR1),
    entrega(_,_,MASSA,E,_,_),
    (MASSA>MAIOR1,MAIOR is MASSA, NODE_MAIOR is E;MAIOR is MAIOR1, NODE_MAIOR is NODE_MAIOR1).


maior_massa(Nome,LE,LE_ORDENADA):-
    maior_massa1(Nome,LE,LE_ORDENADA).

maior_massa1(_,[],[]).

maior_massa1(Nome,LE,[PROX|LE_ORDENADA]):-
    procura_maior(Nome,LE,_,PROX), delete(LE,PROX,LE1),
    maior_massa1(Nome,LE1,LE_ORDENADA).


%Heuristica Combinada

heuristica_combinada(Nome,LAPerm,Tempo):-
    partida_chegada(PC),
    entregas(LA),
    append([PC|LA],[],LACompleto),
    menor_tempo_massa(Nome,LACompleto,LAPerm),
    calcula_custo(Nome,LAPerm,Tempo).

procura_menor_tempo_massa(_,_,[],9999999,0).

procura_menor_tempo_massa(Nome,ATUAL,[E|LE],MENOR,NODE_MENOR):-
    procura_menor_tempo_massa(Nome,ATUAL,LE,MENOR1,NODE_MENOR1),
    dadosCam_t_e_ta(Nome,ATUAL,E,TEMPO,_,_),
    entrega(_,_,MASSA,E,_,_),
    MIS is MASSA * TEMPO,
    (MIS<MENOR1,MENOR is MIS, NODE_MENOR is E;MENOR is MENOR1, NODE_MENOR is NODE_MENOR1).


menor_tempo_massa(Nome,[E|LE],LE_ORDENADA):-
    menor_tempo1_massa(Nome,E,LE,LE_ORDENADA).

menor_tempo1_massa(_,_,[],[]).

menor_tempo1_massa(Nome,ATUAL,LE,[PROX|LE_ORDENADA]):-
    procura_menor_tempo_massa(Nome,ATUAL,LE,_,PROX), delete(LE,PROX,LE1),
    menor_tempo1_massa(Nome,PROX,LE1,LE_ORDENADA).








minMaj(NomeCamiao,ListaCustosMinorante,ListaCustosMajorante,ListaEnergias,Minorante,Majorante):- entregas1(NomeCamiao,E,ListaCustosMinorante,Minorante),entregasMaior1(NomeCamiao,E,ListaCustosMajorante,ListaEnergias,Majorante).

entregas1(NomeCamiao,E,ListaMenoresValores,ValorMinorante):-getListaEntregas(E),entregas2(NomeCamiao,E,E,ListaMenoresValores),entregasArmazemFinal(NomeCamiao,E,5,MinoranteArmazemFinal),append([ListaMenoresValores,[MinoranteArmazemFinal]],ListaDeMinorantes),somarLista(ListaDeMinorantes,ValorMinorante).

entregas2(_,[],_,[]).
entregas2(NomeCamiao,[H|T],ListaEntregasAux,[ValorMenor|ValorMenor1]):- entregas3(NomeCamiao,ListaEntregasAux,H,ValorMenor),entregas2(NomeCamiao,T,ListaEntregasAux,ValorMenor1).

entregas3(NomeCamiao,T,H,ValorMenor):-delete(T,H,T1),custo1(NomeCamiao,T1,H,ListaCustos),menor(ListaCustos,ValorMenor).
entregasArmazemFinal(NomeCamiao,T,H,ValorMenor):-custoArmazemFinal(NomeCamiao,T,H,ListaCustos),menor(ListaCustos,ValorMenor).


getListaEntregas([H|T]):-findall(Id,entrega(_,_,_,Id,_,_),[H|T]).

custo1(_,[],_,[]).
custo1(NomeCamiao,[A|T],ArmazemDestino,[L|L1]):-dadosCam_t_e_ta(NomeCamiao,A,ArmazemDestino,Custo,_,_), entrega(_,_,_,ArmazemDestino,_,TempRet),entrega(_,_,Massa,ArmazemDestino,_,_),carateristicasCam(NomeCamiao,Peso,PesoMaximo,_,_,_),Tara is Peso + PesoMaximo,PesoMomento is Peso + Massa,CustoAux is (PesoMomento/Tara)*Custo,L is CustoAux + TempRet,custo1(NomeCamiao,T,ArmazemDestino,L1).

custoArmazemFinal(_,[],_,[]).
custoArmazemFinal(NomeCamiao,[A|T],ArmazemDestino,[L|L1]):-dadosCam_t_e_ta(NomeCamiao,A,ArmazemDestino,Custo,_,_),carateristicasCam(NomeCamiao,Peso,PesoMaximo,_,_,_),Tara is Peso + PesoMaximo,CustoAux is (Peso/Tara)*Custo,L is CustoAux ,custoArmazemFinal(NomeCamiao,T,ArmazemDestino,L1).


menor([X],X):-!.
menor([X|L],M):- menor(L,M1), ((X<M1,!,M is X) ; M is M1).

somarLista([], 0).
somarLista([H|T], ValorMinorante) :- sum_list(T, Rest),ValorMinorante is H + Rest.



%Minorante & Majorante

entregasMaior1(NomeCamiao,E,ListaMaioresValores,TempoExtra,ValorMajorante):-getListaEntregasMaior(E),entregasMaior2(NomeCamiao,E,E,ListaMaioresValores,TempoExtra),entregasMaiorArmazemFinal(NomeCamiao,E,5,MajoranteArmazemFinal,ValorEnergia),append([ListaMaioresValores,[MajoranteArmazemFinal]],ListaDeCustos),append([TempoExtra,[ValorEnergia]],ListaTotalEnergia),somarLista(ListaTotalEnergia,TempoAdicional),append([ListaDeCustos,[TempoAdicional]],ListaDeMajorantes),somarLista(ListaDeMajorantes,ValorMajorante).

entregasMaior2(_,[],_,[],[]).
entregasMaior2(NomeCamiao,[H|T],ListaEntregasAux,[ValorMaior|ValorMaior1],[ValorMaiorEnergia|ValorMaiorEnergia1]):- entregasMaior3(NomeCamiao,ListaEntregasAux,H,ValorMaior,ValorMaiorEnergia),entregasMaior2(NomeCamiao,T,ListaEntregasAux,ValorMaior1,ValorMaiorEnergia1).

entregasMaior3(NomeCamiao,T,H,ValorMaior,ValorMaiorEnergia):-calculoPeso(PesoTotal),delete(T,H,T1),custo1Maior(NomeCamiao,T1,H,ListaCustos,PesoTotal,ListaEnergias),maior(ListaCustos,ValorMaior,ListaEnergias,ValorMaiorEnergia).
entregasMaiorArmazemFinal(NomeCamiao,T,H,ValorMaior,ValorMaiorEnergia):-custoMaiorArmazemFinal(NomeCamiao,T,H,ListaCustos,ListaEnergias),maior(ListaCustos,ValorMaior,ListaEnergias,ValorMaiorEnergia).


getListaEntregasMaior([H|T]):-findall(Id,entrega(_,_,_,Id,_,_),[H|T]).

custo1Maior(_,[],_,[],_,[]).
custo1Maior(NomeCamiao,[A|T],ArmazemDestino,[L|L1],PesoTotal,[B|B1]):-dadosCam_t_e_ta(NomeCamiao,A,ArmazemDestino,Custo,Energia,TempoCarregamento), entrega(_,_,_,ArmazemDestino,_,TempRet),entrega(_,_,_,ArmazemDestino,_,_),carateristicasCam(NomeCamiao,Peso,PesoMaximo,_,_,_),Tara is Peso + PesoMaximo,PesoMomento is Peso + PesoTotal,CustoAux is (PesoMomento/Tara)*Custo, comparar(TempRet,TempoCarregamento, MaiorAdicional), L is CustoAux + MaiorAdicional,calculaEnergias(NomeCamiao,Energia,TempoExtra),B is  TempoExtra ,custo1Maior(NomeCamiao,T,ArmazemDestino,L1,PesoTotal,B1).

custoMaiorArmazemFinal(_,[],_,[],[]).
custoMaiorArmazemFinal(NomeCamiao,[A|T],ArmazemDestino,[L|L1],[B|B1]):-dadosCam_t_e_ta(NomeCamiao,A,ArmazemDestino,Custo,Energia,_),carateristicasCam(NomeCamiao,Peso,PesoMaximo,_,_,_),Tara is Peso + PesoMaximo,CustoAux is (Peso/Tara)*Custo,L is CustoAux,calculaEnergias(NomeCamiao,Energia,TempoExtra),B is  TempoExtra ,custoMaiorArmazemFinal(NomeCamiao,T,ArmazemDestino,L1,B1).

maior([X],X,[B],B):-!.
maior([X|L],C,[B|B1],M):- maior(B1,M1,L,C1), ((B>M1,!,M is B,C is X ) ; M is M1, C is C1).

comparar(TempoDescarga,TempoCarregamento, Maior):- (TempoCarregamento > TempoDescarga, Maior is TempoCarregamento); Maior is TempoDescarga.

calculoPeso(PesoTotal):- findall(Peso, entrega(_,_,Peso,_,_,_), ListaP), somarLista(ListaP, PesoTotal).

calculaEnergias(NomeCam,EnergiaGasta,TempoAdicional):- maxMinBat(NomeCam,CapMaxBat,CapMinBat),DifCapBat is CapMaxBat-CapMinBat,TempoAdicional is ((60*EnergiaGasta)/DifCapBat).

maxMinBat(NomeCam,CapMaxBat,CapMinBat):-carateristicasCam(NomeCam,_,_,CapBat,_,_),CapMaxBat is 0.8*CapBat,CapMinBat is 0.2*CapBat.




